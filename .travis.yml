notifications:
  email: false
sudo: enabled
os: linux
language: python
cache: pip
python: 3.7-dev
install:
  - python3 -m pip install -r pre_requirements.txt
  - python3 -m pip install -r requirements.txt -r dev_requirements.txt
  - cp ./config/default_config.json ./config.json
  - python3 start.py -p install all

matrix:
  include:
    - os: osx
      osx_image: xcode8.3
      language: generic
      before_cache:
        - brew cleanup
      cache:
        directories:
          - $HOME/Library/Caches/Homebrew
      before_install:
        - brew update || travis_terminate 1;
        - brew upgrade python || brew install python || travis_terminate 1;
        - python3 -m venv venv || travis_terminate 1;
        - source venv/bin/activate;

      script:
        - pytest -n 3 --cov=. --cov-config=.coveragerc tests/unit_tests tests/functional_tests

    - os: linux
      python: nightly
      language: python
      before_install:
        - sudo bash ./docs/install/linux_dependencies.sh

      script:
        - pytest -n 5 --cov=. --cov-config=.coveragerc tests/unit_tests tests/functional_tests tests/endurance_tests

      after_success:
        - if [[ $TRAVIS_PULL_REQUEST == 'false' ]]; then bash coveralls; fi

before_deploy:
  - python3 -m nltk.downloader -d $NLTK_DATA words
  - pyinstaller docs/delivery/start.spec
  - mv dist/OctoBot dist/OctoBot_$TRAVIS_OS_NAME
  - shasum dist/OctoBot_$TRAVIS_OS_NAME
  - python3 setup.py sdist bdist_wheel
  - python3 -m twine check dist/*

deploy:
  - provider: pypi
    user:
      secure: drvdAty7FzyK3SqUKKsGQJI9PLogE3UqCHxIVfbet8VYypBVoWCG0HHQHJl08q368zzylO45tUjBQP2OdfurpXnGIEcVhVvbuD4v6SrUX1lH6e/g/JBgKDPz6ZtQXpGrno1EKfop0QZVQojm2xXR9oMNxvvVJlGbWaD5BkztxQ9x4Sy0TQsoFwKawx7YuHHcl33+47YBht1fA+YpkGGKxmsqK74yCqf2GzWYNlAjJAhcos+2eHErMI8CkqnrFIjhpV/LB842AAC6bz41PFWIxll2J58+SFYerVYjOCP2JANe5SAwVQQ/rYCTE0I+pYIQiPVBRVOmSeI4DvLpjtWKrW6Uit1xo/080tZR3MBZLrBnyXERVytNY8OFcquAtwtSpfi2x2pUjRlRcwOG3mWMMfrI/UgM7uEN21iEKH57sw3lTeDGZQeuh/KzLNVsAUQGQN0ek88dlS1vWV3KfHjS1f5S/xCf0Bh4iEpw+U6eU09Xhd5+ijmtZBIZDZKlK2zXpz1MuQf5yyLRdRbCcb5rGZfmfYFYoTZTsp0i0rgxqPvOlY0KZJQwJ7EHKAulka/LkDm9JBH/n1uqF5SyHUduJMZgDT6/p9Tq/n5l3XgoJZgDKQgwA3x+RIRKinlmT9ibFiADB1j7lqLQvyAlIbCdrO/K8ULNkAU4xDrAJfEr9GE=
    password:
      secure: hbel+oqhAyGrzejIoumrVjmMz3cSnD5LxbppLlPQuqPg19AROMx92O+/vquXLj4CurcDdzp3P5Q3FhRUDJLI29SehOEsTM68FVQYWUNXvf6Mbg7dPMNogvifo4wkHxL3+7MwhYhtfunzfdLnSDdmCn6BzbrXFOLpgBvR+j0TeDyd5LzfMc6s7Mm2nuZZ+G8ZUnDamOydxjHuR+UOx0qFRKLKuIt/LFY4x4jnSQhT4oNeSEkkjLdCo7UnWmP3I8RRLdqSKWPQ46k0pB63lYRaixOYSVbj2R3nBycgGAATCBH4RmA5jG1pXyl/uE561F42N3P+9gjHgsscLDbNmLI3EOEQYn5RVifhoWID2b0XeLy0qy5qKQFEaDuy9ggOEj15OYPtwoHA+PUvnbvonpq4Z4819S2Tx+cCtDKDKAD3hMF+FxCDshtLhJPyyVWW/SNC8uxWtscqox2E4jgjGwf/RqEa7EEk3W9RibjoQWoW+aM6f3dcCPdBmYj1+Rp1PPzGnaJ9bFli1uTcGK0iD8D5ybVzQUus6SGOnx0OWtHOVgSOjUS5mRILBVU4eOE2Yuq4aQEVlBkvCqwkFY3sbJY2r4CA/3eGmEJ/lLHzdMimgVezfPQe3cxvciWouteFqea/BICcEUufRxE0w7FtiBFsyE4phmQlOHunFtO+O6gzimQ=
    skip_existing: false
    on:
      repo: Drakkar-Software/OctoBot
      branch: beta
      tags: true
  - provider: releases
    api_key:
      secure: BleYWO52UlS4M+jjx6YpXghthDH6xwP+WWiVOGTEWY0XmwL01Fo931hLIEmIuQ3Ipi9h/DWFgnmG+JcOztMkYc/uvz4O+96xd28fAByw/acJly7LJclOpDO9AJuzZdx+L/yPMtsp3IUG1LbP/RH69RJDaDIJAAz8pJh6D5b+LccL679d2duBSmSQ27W5qU9iRPhOcPGVRF7P/1143OjVZSo9WEHKh7RGC3KVY32HihlPxYaq8YAgXZ5a0OCQN1RZKmL8csvOXKLtkzphm+3OotKTLziX7OgE7CT0M4sVPzdskodgfxB1AmEJ1t6Bar5ouCx5ogdP5EEH+suj5OQRnMQXlao/HM2/9nC51Bqnib0oeEylyM0B+3++6wfUB7DwIns+znK8IhncZKTYdT7QZqLhasP64nV573KGpLBDfsvx3rpIxRypoZ4OTHmFEgC5nwszzF7yVeUwNt7CSPESwS4GA8l2PBe86VSUSeBaAj+awdHnNgjHpzYALBi0vemd+gmzOdT/gKsSfCI5CripgnoQT0kQG08Q2sU3GjKViQwvn3nqdKU9ttnVbJALcQXEr6J14I1AoV//Isd4Ubi0cdTFJsL3bvewQkGtdJkvkuerQhfnSc5jRZMkK2V6i8Lo0NOMKmd2QI3rgTae00hvu4CBBJ100mOmcLiq2wv8BVA=
    file: dist/OctoBot_$TRAVIS_OS_NAME
    skip_cleanup: true
    name: Release - $TRAVIS_TAG
    on:
      repo: Drakkar-Software/OctoBot
      branch: beta
      tags: true
